(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();class o{constructor(e){this.seconds=0,this.minutes=0,this.interval=null,this.clock=e}start(){this.interval||(this.updateClock(),this.interval=setInterval(()=>{this.seconds++,this.seconds==60&&(this.seconds=0,this.minutes++),this.updateClock()},1e3))}startFrom(e,t){this.seconds=t,this.minutes=e,this.start()}stop(){return clearInterval(this.interval),this.interval=null,`${this.minutes} : ${this.seconds}`}catch(){return`${this.minutes} : ${this.seconds}`}restart(){this.stop(),this.seconds=0,this.minutes=0,this.start()}updateClock(){this.clock.textContent=`${this.minutes.toString().padStart(2,"0")} : ${this.seconds.toString().padStart(2,"0")}`}}function l(){let a="#",e="0123456789ABCDEF";for(let t=0;t<6;t++){let s=Math.floor(Math.random()*16);a+=e[s]}return a}function c(a){for(let e=a.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[a[e],a[t]]=[a[t],a[e]]}return a}class d{constructor(){this.grid=document.querySelector(".grid"),this.numBoxes=0}generateBoard(e){switch(this.grid.removeAttribute("data-info-size"),this.grid.classList.remove("easy","medium","hard"),this.grid.innerHTML="",this.grid.classList.add(e),e){case"easy":this.numBoxes=12;break;case"medium":this.numBoxes=30;break;case"hard":this.numBoxes=56;break}this.grid.setAttribute("data-info-size",this.numBoxes);for(let t=0;t<this.numBoxes;t++){let s=document.createElement("div");if(t%2===1){let i=l();s.style.backgroundColor=i,s.setAttribute("data-original-color",i);let r=this.grid.children[t-1];r.style.backgroundColor=i,r.setAttribute("data-original-color",i)}s.classList.add("box"),this.grid.appendChild(s)}return this.numBoxes}createBoardFrom(e){let t=e;this.numBoxes=t.length;for(let s=0;s<this.numBoxes;s++){let i=document.createElement("div"),r=t[s].color;t[s].classes.forEach(n=>{i.classList.add(n)}),i.setAttribute("data-original-color",r),i.style.backgroundColor=r,this.grid.appendChild(i)}}}class h{constructor(){this.user,this.difficulty,this.active,this.numCorrects=0,this.currentScore=0,this.numBoxes=0,this.timeoutID=null,this.currentTime,this.gameBox=new d,this.usersData=JSON.parse(localStorage.getItem("users")),this.usersGames=JSON.parse(localStorage.getItem("usersGames")),this.userMenu=document.querySelector(".user__menu"),this.logInBtn=document.querySelector(".login-btn"),this.logInBtn.addEventListener("click",()=>this.logIn()),this.logOutBtn=document.querySelector(".logout--btn"),this.logOutBtn.addEventListener("click",()=>this.logOut()),this.newUserBtn=document.querySelector(".signup-btn"),this.newUserBtn.addEventListener("click",()=>this.signUp()),this.newgameContainer=document.querySelector(".newgame__menu"),this.newGameBtn=document.querySelector(".newgame--btn"),this.newGameBtn.addEventListener("click",()=>{this.difficultyContainer.classList.remove("hidden"),this.newgameContainer.classList.add("hidden")}),this.loadGameBtn=document.querySelector(".loadgame--btn"),this.loadGameBtn.addEventListener("click",()=>{this.loadGame(),this.newgameContainer.classList.add("hidden")}),this.difficultyContainer=document.querySelector(".difficulty__container"),this.difficultyForm=document.querySelector(".difficulty__form"),this.difficultyForm.addEventListener("submit",e=>e.preventDefault()),this.radioBtns=document.querySelectorAll('input[name="difficulty"]'),this.radioBtns.forEach(e=>{e.addEventListener("change",t=>{this.difficulty=t.target.value,this.numBoxes=this.gameBox.generateBoard(this.difficulty)})}),this.backBtnDifficulty=document.querySelector(".back__btn--difficulty"),this.backBtnDifficulty.addEventListener("click",()=>{this.difficultyContainer.classList.add("hidden"),this.newgameContainer.classList.remove("hidden"),this.grid.innerHTML=""}),this.startGameBtn=document.querySelector(".form__btn"),this.startGameBtn.addEventListener("click",()=>this.startGame()),this.grid=document.querySelector(".grid"),this.gameInfo=document.querySelector(".game__info"),this.clock=document.querySelector(".clock"),this.timer=new o(this.clock),this.scoreSpan=document.querySelector(".score"),this.restartBtn=document.querySelector(".btn--restart"),this.restartBtn.addEventListener("click",()=>this.restartGame()),this.changeDifficultyBtn=document.querySelector(".btn--change"),this.changeDifficultyBtn.addEventListener("click",()=>{this.difficultyContainer.classList.toggle("hidden"),this.backBtnDifficulty.classList.add("hidden")}),this.saveGameBtn=document.querySelector(".btn--save"),this.saveGameBtn.addEventListener("click",()=>this.saveGame()),this.pausedMenu=document.querySelector(".game__paused"),this.pauseGameBoton=document.querySelector(".btn--pause"),this.pauseGameBoton.addEventListener("click",()=>this.pausedGameMenu("pause")),this.backBtnPause=document.querySelector(".back__btn--pause"),this.gameWon=document.querySelector(".game__won"),this.victoryMenu=document.querySelector(".container__victory"),this.victoryTitleSpan=document.querySelector(".victory__titlespan"),this.resultScoreSpan=document.querySelector(".result--score"),this.resulTimeSpan=document.querySelector(".result--time"),this.resultDifficultySpan=document.querySelector(".result--difficulty"),this.victoryNewGameBtn=document.querySelector(".victory--newgame"),this.victoryNewGameBtn.addEventListener("click",()=>{this.difficultyContainer.classList.toggle("hidden"),this.backBtnDifficulty.classList.add("hidden")}),this.victorySaveScoreBtn=document.querySelector(".victory--savescore"),this.victorySaveScoreBtn.addEventListener("click",()=>this.storeUserData())}signUp(){let e=prompt("Introduce tu nombre de usuario");if(e){if(this.usersData=this.usersData||{},this.usersData[e]){alert("Ese nombre de usuario ya existe");return}this.usersData[e]={highestScore:{easy:0,medium:0,hard:0},fastestTime:{easy:"0:0",medium:"0:0",hard:"0:0"}},localStorage.setItem("users",JSON.stringify(this.usersData)),this.logIn(e)}}logIn(e=null){if(this.user){alert("Ya estas logueado");return}let t=e||prompt("Ingresa tu nombre de usuario");if(!this.usersData[t]){alert("Este nombre de usuario no existe");return}if(!this.usersData[t]){alert("Este nombre de usuario no existe");return}this.user=t;let s=document.createElement("h2");s.classList.add("welcome__message"),s.innerHTML="Bienvenido ";let i=document.createElement("span");i.classList.add("welcome__span"),i.innerHTML=`${this.user} `,s.appendChild(i),this.userMenu.insertBefore(s,this.logOutBtn),this.userMenu.classList.add("logged"),this.logInBtn.classList.add("hidden"),this.newUserBtn.classList.add("hidden"),this.logOutBtn.classList.remove("hidden")}logOut(){this.user="",this.logInBtn.classList.remove("hidden"),this.newUserBtn.classList.remove("hidden"),this.logOutBtn.classList.add("hidden"),document.querySelector(".welcome__message").classList.add("hidden"),this.userMenu.classList.remove("logged")}startGame(){this.timer.restart(),this.currentScore=0,this.handleScore(),this.difficultyContainer.classList.add("hidden"),this.pausedMenu.classList.add("hidden"),this.gameWon.classList.add("hidden"),this.difficulty||alert("Por favor seleccione una dificultad"),document.querySelector(".game__info").classList.remove("hidden"),this.boxes=c(Array.from(document.querySelectorAll(".box"))),this.timer.start(this.clock),this.grid.innerHTML="",this.boxes.forEach(t=>{t.classList.add("black"),t.classList.remove("correct","active"),t.setAttribute("draggable","false"),t.addEventListener("click",this.flipCard.bind(this)),t.addEventListener("dragstart",this.handleDragStart.bind(this)),t.addEventListener("dragover",this.handleDragOver.bind(this)),t.addEventListener("drop",this.handleDrop.bind(this)),this.grid.appendChild(t)})}restartGame(){this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=null),this.timer.restart();let e=document.querySelectorAll(".correct , .active"),s=Array.from(document.querySelectorAll(".box")).filter(r=>!r.classList.contains("black"));[...e,...s].forEach(r=>{r.classList.add("black"),r.classList.remove("active","correct"),r.classList.add("black"),r.setAttribute("draggable","false"),r.addEventListener("click",this.flipCard)}),this.numCorrects=0,this.active=null,this.boxes=c(this.boxes),this.grid.innerHTML="",this.boxes.forEach(r=>this.grid.appendChild(r)),this.currentScore=0,this.handleScore(),this.pausedMenu.classList.add("hidden")}saveGame(){if(!this.user){alert("Debes iniciar sesion para guardar la partida");return}this.currentTime=this.timer.catch(),this.usersGames=this.usersGames||{};let e=Array.from(this.grid.children).map(s=>({classes:[...s.classList],color:s.getAttribute("data-original-color")}));this.usersGames[this.user]={grid:e,score:this.currentScore,time:this.currentTime,difficulty:this.difficulty},localStorage.setItem("usersGames",JSON.stringify(this.usersGames)),this.pausedMenu.classList.add("hidden");let t=this.currentTime.split(":");this.timer.startFrom(t[0],t[1])}loadGame(){this.gameInfo.classList.remove("hidden"),this.gameBtns.classList.remove("hidden"),this.user||(this.user=prompt("Ingresa tu nombre de usuario para cargar partida")),this.currentScore=this.usersGames[this.user].score,this.handleScore(this.currentScore),this.currentTime=this.usersGames[this.user].time;let e=this.currentTime.split(":");this.timer.startFrom(e[0],e[1]);let t=this.usersGames[this.user].grid;this.gameBox.createBoardFrom(t),this.boxes=Array.from(document.querySelectorAll(".box")),this.grid.innerHTML="",this.grid.classList.add(this.usersGames[this.user].difficulty),this.boxes.forEach(s=>{s.addEventListener("click",this.flipCard.bind(this)),s.addEventListener("dragstart",this.handleDragStart.bind(this)),s.addEventListener("dragover",this.handleDragOver.bind(this)),s.addEventListener("drop",this.handleDrop.bind(this)),this.grid.appendChild(s)})}pausedGameMenu(e){switch(this.currentTime=this.timer.stop(),e){case"victory":this.gameWon.classList.remove("hidden"),this.user?this.victoryTitleSpan.innerHTML=`${this.user}`:this.victoryTitleSpan.innerHTML="Usuario",this.resultScoreSpan.innerHTML=`${this.currentScore}`,this.resulTimeSpan.innerHTML=`${this.currentTime}`,this.resultDifficultySpan.innerHTML=`${this.difficulty}`;break;case"pause":this.pausedMenu.classList.remove("hidden");const t=()=>{let s=this.currentTime.split(":");this.timer.startFrom(s[0],s[1]),this.pausedMenu.classList.add("hidden"),this.backBtnPause.removeEventListener("click",t)};this.backBtnPause.addEventListener("click",t);break}console.log(this.currentTime)}storeUserData(){if(this.user||(this.user=prompt("Introduce tu nombre de usuario")),!this.usersData||!this.usersData[this.user]){alert("No existe ningun usuario con ese nombre");return}let e=this.usersData[this.user].highestScore[this.difficulty],s=this.usersData[this.user].fastestTime[this.difficulty].split(":").map(r=>r=parseInt(r)),i=this.currentTime.split(":").map(r=>r=parseInt(r));s[0]<i[0]?this.usersData[this.user].fastestTime[this.difficulty]=this.currentTime(console.log("hiciste mas minutes")):s[0]==i[0]&&(console.log("tienes los mismos minutos"),s[0]<i[1]&&(console.log("hiciste mas segundos"),this.usersData[this.user].fastestTime[this.difficulty]=this.currentTime)),this.currentScore>e&&(this.usersData[this.user].highestScore[this.difficulty]=this.currentScore),localStorage.setItem("users",JSON.stringify(this.usersData))}flipCard(e){this.currentBox=e.target,!this.active&&this.currentBox&&!this.currentBox.classList.contains("correct")&&(this.active=this.currentBox,this.active.classList.add("active"),this.active.classList.remove("black"),this.active.setAttribute("draggable","true"))}handleDragStart(e){(e.target.getAttribute("draggable")==="false"||e.target!==this.active)&&e.preventDefault()}handleDragOver(e){e.target.classList.contains("black")&&e.preventDefault()}handleDrop(e){const t=e.target.closest(".box");!t||t===this.active||(t.classList.remove("black"),this.active.dataset.originalColor!==t.dataset.originalColor?this.handleError(t):this.handleCorrect(t))}handleCorrect(e){this.currentScore+=100,this.handleScore(),this.active.classList.remove("active","black"),this.active.classList.add("correct"),this.active.setAttribute("draggable","false"),this.active.removeEventListener("click",this.flipCard),e.classList.remove("black"),e.classList.add("correct"),e.removeEventListener("click",this.flipCard),this.active=null,this.numCorrects++,this.checkWin()}handleError(e){this.currentScore>0&&(this.currentScore-=10,this.handleScore()),this.active.classList.remove("active"),this.active.classList.add("error"),this.active.setAttribute("draggable","false"),e.classList.add("error"),this.timeoutID=setTimeout(()=>{this.active.classList.add("black"),this.active.classList.remove("error"),e.classList.add("black"),e.classList.remove("error"),this.active=null},800)}handleScore(){this.scoreSpan.innerHTML=`PUNTUACION: ${this.currentScore}`}checkWin(){this.numCorrects===this.numBoxes/2&&(this.pausedGameState="victory",this.pausedGameMenu(this.pausedGameState))}}new h;
